<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.
broadcast chan sigIn,sigOut;
broadcast chan actNodeHRA,actNodeSA,actNodeHisA,actNodeOS,actNodeSP,actNodeFP,actNodeAV,actNodeHisH,actNodeHisV,actNodeRV;
broadcast chan actPathHRA,actPathSA,actPathHisA,actPathOS,actPathSP,actPathFP,actPathAV,actPathHisH,actPathHisV,actPathRV;
clock gclk;

// ==== node ====
const int tERPMinHRA = 100;
const int tERPMaxHRA = 100;

const int tERPMinSA=100;
const int tERPMaxSA=100;

const int tERPMinHisA=100;
const int tERPMaxHisA=100;

const int tERPMinOS = 100;
const int tERPMaxOS = 100;

const int tERPMinSP=340;
const int tERPMaxSP=340;

const int tERPMinFP=100;
const int tERPMaxFP=100;

const int tERPMinAV = 100;
const int tERPMaxAV = 100;

const int tERPMinHisH=100;
const int tERPMaxHisH=100;

const int tERPMinHisV=100;
const int tERPMaxHisV=100;

const int tERPMinRV = 100;
const int tERPMaxRV = 100;

// ==== path ====
const int tCondMinHRASA = 20;
const int tCondMaxHRASA = 20;

const int tCondMinSAHisA=28;
const int tCondMaxSAHisA=28;

const int tCondMinHisAOS=5;
const int tCondMaxHisAOS=5;

// Fast
const int tCondMinOSFP=10;
const int tCondMaxOSFP=10;

const int tCondMinFPAV=19;
const int tCondMaxFPAV=19;

// Slow
const int tCondMinOSSP=186;
const int tCondMaxOSSP=186;

const int tCondMinSPAV=150;
const int tCondMaxSPAV=150;

// H V
const int tCondMinAVHisH=5;
const int tCondMaxAVHisH=5;

const int tCondMinHisHHisV=86;
const int tCondMaxHisHHisV=86;

const int tCondMinHisVRV=20;
const int tCondMaxHisVRV=20;

// AVNRT xuejie lunwen P52
// link: https://www.yuque.com/docs/share/76581a17-2ea5-4d7b-ab60-6263ea67140b?# 《区分AVRT与AVNRT实验》
// inputs = [0, 320]
// signal types      = [ V,  H,   A,   V,   H ,  A,   H,   A,   V,    H,    A,    V ]
// real observations = [20, 106, 145, 340, 426, 465, 731, 761, 779, 1069, 1099, 1117]
// fake observations = [20, 106, 145, 340, 426, 465, 801, 830, 887, 1166, 1195, 1252]

// AVRT xuejie lunwen P54
// link: https://www.yuque.com/docs/share/76581a17-2ea5-4d7b-ab60-6263ea67140b?# 《区分AVRT与AVNRT实验》
// inputs = [0, 380]
// signal types      = [ V,  H,  A,   V,   H,   A,    H,    V,    A,    H,    V,    A ]
// real observations = [20, 60, 206, 400, 440, 586, 1089, 1126, 1258, 1427, 1464, 1596]
// fake observations = [20, 60, 186, 400, 440, 566, 1069, 1109, 1235, 1738, 1778, 1904]</declaration>
	<template>
		<name x="5" y="5">Node</name>
		<parameter>broadcast chan &amp;actNode, broadcast chan &amp;actPath, int tRestMin, int tRestMax, int tERPMin, int tERPMax</parameter>
		<declaration>// Place local declarations here.
clock t;</declaration>
		<location id="id0" x="-187" y="-76">
			<name x="-221" y="-110">Rest</name>
			<label kind="invariant" x="-272" y="-68">t&lt;=tRestMax</label>
		</location>
		<location id="id1" x="25" y="-76">
			<name x="-17" y="-85">ERP</name>
			<label kind="invariant" x="34" y="-59">t&lt;=tERPMax</label>
		</location>
		<location id="id2" x="-51" y="-119">
			<committed/>
		</location>
		<init ref="id0"/>
		<transition>
			<source ref="id1"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="76" y="-93">actNode?</label>
			<nail x="67" y="-102"/>
			<nail x="67" y="-59"/>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="-34" y="-136">actPath!</label>
			<nail x="25" y="-119"/>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="-178" y="-136">actNode?</label>
			<label kind="assignment" x="-102" y="-136">t=0</label>
			<nail x="-187" y="-119"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="guard" x="-153" y="-51">t&gt;=tERPMin</label>
			<label kind="assignment" x="-51" y="-51">t=0</label>
			<nail x="25" y="-34"/>
			<nail x="-187" y="-34"/>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id2"/>
			<label kind="guard" x="-153" y="-76">t&gt;=tRestMin</label>
			<label kind="assignment" x="-153" y="-93">t=0</label>
			<nail x="-51" y="-76"/>
		</transition>
	</template>
	<template>
		<name>NodeN</name>
		<parameter>broadcast chan &amp;actNode, broadcast chan &amp;actPath,int tERPMin, int tERPMax</parameter>
		<declaration>clock t;</declaration>
		<location id="id3" x="102" y="51">
			<name x="68" y="17">Rest</name>
		</location>
		<location id="id4" x="246" y="51">
			<name x="254" y="17">ERP</name>
			<label kind="invariant" x="255" y="68">t&lt;=tERPMax</label>
		</location>
		<location id="id5" x="170" y="8">
			<committed/>
		</location>
		<init ref="id3"/>
		<transition>
			<source ref="id4"/>
			<target ref="id4"/>
			<label kind="synchronisation" x="289" y="34">actNode?</label>
			<nail x="289" y="25"/>
			<nail x="289" y="68"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id4"/>
			<label kind="synchronisation" x="190" y="-12">actPath!</label>
			<nail x="246" y="8"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="94" y="-17">actNode?</label>
			<label kind="assignment" x="128" y="8">t=0</label>
			<nail x="102" y="8"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id3"/>
			<label kind="guard" x="136" y="85">t&gt;=tERPMin</label>
			<label kind="assignment" x="153" y="102">t=0</label>
			<nail x="246" y="102"/>
			<nail x="102" y="102"/>
		</transition>
	</template>
	<template>
		<name>Path</name>
		<parameter>broadcast chan &amp;actPath1, broadcast chan &amp;actPath2, broadcast chan &amp;actNode1, broadcast chan &amp;actNode2, int tCondMin, int tCondMax</parameter>
		<declaration>clock t;</declaration>
		<location id="id6" x="-212" y="-68">
			<name x="-212" y="-102">Idle</name>
		</location>
		<location id="id7" x="-340" y="-68">
			<name x="-382" y="-102">Ante</name>
			<label kind="invariant" x="-408" y="-59">t&lt;=tCondMax</label>
		</location>
		<location id="id8" x="-85" y="-68">
			<name x="-76" y="-102">Retro</name>
			<label kind="invariant" x="-93" y="-59">t&lt;=tCondMax</label>
		</location>
		<location id="id9" x="-212" y="16">
			<label kind="invariant" x="-204" y="24">t&lt;=2</label>
		</location>
		<init ref="id6"/>
		<transition>
			<source ref="id7"/>
			<target ref="id9"/>
			<label kind="synchronisation" x="-322" y="50">actPath2?</label>
			<label kind="assignment" x="-322" y="67">t=0</label>
			<nail x="-340" y="67"/>
			<nail x="-212" y="67"/>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id9"/>
			<label kind="synchronisation" x="-194" y="50">actPath1?</label>
			<label kind="assignment" x="-194" y="67">t=0</label>
			<nail x="-85" y="67"/>
			<nail x="-212" y="67"/>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id9"/>
			<label kind="guard" x="-331" y="-17">t&gt;=tCondMin</label>
			<label kind="synchronisation" x="-331" y="0">actNode2!</label>
			<label kind="assignment" x="-322" y="16">t=0</label>
			<nail x="-340" y="16"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id6"/>
			<label kind="guard" x="-255" y="-43">t&gt;=2</label>
			<label kind="assignment" x="-204" y="-43">t=0</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id9"/>
			<label kind="guard" x="-187" y="-17">t&gt;=tCondMin</label>
			<label kind="synchronisation" x="-187" y="0">actNode1!</label>
			<label kind="assignment" x="-127" y="16">t=0</label>
			<nail x="-85" y="16"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id8"/>
			<label kind="synchronisation" x="-178" y="-94">actPath2?</label>
			<label kind="assignment" x="-161" y="-68">t=0</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="-306" y="-94">actPath1?</label>
			<label kind="assignment" x="-280" y="-68">t=0</label>
		</transition>
	</template>
	<template>
		<name>ConvertOut</name>
		<location id="id10" x="-85" y="-17">
		</location>
		<location id="id11" x="42" y="-17">
			<name x="59" y="-25">out</name>
			<committed/>
		</location>
		<init ref="id10"/>
		<transition>
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-68" y="-93">actPathHisA?</label>
			<nail x="-85" y="-68"/>
			<nail x="42" y="-68"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-68" y="-42">actPathHisV?</label>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-68" y="-68">actPathHisH?</label>
			<nail x="-85" y="-42"/>
			<nail x="42" y="-42"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-51" y="0">sigOut!</label>
			<nail x="42" y="17"/>
			<nail x="-85" y="17"/>
		</transition>
	</template>
	<template>
		<name>ConvertIn</name>
		<location id="id12" x="0" y="0">
		</location>
		<location id="id13" x="119" y="0">
			<committed/>
		</location>
		<init ref="id12"/>
		<transition>
			<source ref="id12"/>
			<target ref="id13"/>
			<label kind="synchronisation" x="34" y="-17">sigIn?</label>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="17" y="17">actNodeRV!</label>
			<nail x="119" y="34"/>
			<nail x="0" y="34"/>
		</transition>
	</template>
	<template>
		<name>AVNRTInput</name>
		<location id="id14" x="-348" y="-34">
			<name x="-365" y="-68">Initial</name>
			<label kind="invariant" x="-374" y="-17">gclk&lt;=0</label>
		</location>
		<location id="id15" x="-212" y="-34">
			<label kind="invariant" x="-255" y="-17">gclk&lt;=320</label>
		</location>
		<location id="id16" x="-85" y="-34">
			<name x="-102" y="-68">Finish</name>
		</location>
		<init ref="id14"/>
		<transition>
			<source ref="id15"/>
			<target ref="id16"/>
			<label kind="guard" x="-195" y="-34">gclk&gt;=320</label>
			<label kind="synchronisation" x="-178" y="-51">sigIn!</label>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id15"/>
			<label kind="guard" x="-331" y="-34">gclk&gt;=0</label>
			<label kind="synchronisation" x="-331" y="-51">sigIn!</label>
		</transition>
	</template>
	<template>
		<name>AVRTInput</name>
		<location id="id17" x="-238" y="-34">
			<name x="-255" y="-68">Initial</name>
			<label kind="invariant" x="-264" y="-17">gclk&lt;=0</label>
		</location>
		<location id="id18" x="-102" y="-34">
			<label kind="invariant" x="-145" y="-17">gclk&lt;=380</label>
		</location>
		<location id="id19" x="25" y="-34">
			<name x="8" y="-68">Finish</name>
		</location>
		<init ref="id17"/>
		<transition>
			<source ref="id18"/>
			<target ref="id19"/>
			<label kind="guard" x="-85" y="-34">gclk&gt;=380</label>
			<label kind="synchronisation" x="-68" y="-51">sigIn!</label>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id18"/>
			<label kind="guard" x="-221" y="-34">gclk&gt;=0</label>
			<label kind="synchronisation" x="-221" y="-51">sigIn!</label>
		</transition>
	</template>
	<template>
		<name>Timer</name>
		<declaration>clock t;</declaration>
		<location id="id20" x="-195" y="-144">
			<label kind="invariant" x="-229" y="-127">t&lt;=8000</label>
		</location>
		<location id="id21" x="-68" y="-144">
			<name x="-78" y="-178">Stop</name>
		</location>
		<init ref="id20"/>
		<transition>
			<source ref="id20"/>
			<target ref="id21"/>
			<label kind="guard" x="-161" y="-161">t&gt;=8000</label>
		</transition>
	</template>
	<system>// ======== Node ========
NHRA=NodeN(actNodeHRA,actPathHRA,tERPMinHRA,tERPMaxHRA);
NSA=NodeN(actNodeSA,actPathSA,tERPMinSA,tERPMaxSA);
NHisA=NodeN(actNodeHisA,actPathHisA,tERPMinHisA,tERPMaxHisA);

NOS=NodeN(actNodeOS,actPathOS,tERPMinOS,tERPMaxOS);
NSP=NodeN(actNodeSP,actPathSP,tERPMinSP,tERPMaxSP);
NFP=NodeN(actNodeFP,actPathFP,tERPMinFP,tERPMaxFP);
NAV=NodeN(actNodeAV,actPathAV,tERPMinAV,tERPMaxAV);

NHisH=NodeN(actNodeHisH,actPathHisH,tERPMinHisH,tERPMaxHisH);
NHisV=NodeN(actNodeHisV,actPathHisV,tERPMinHisV,tERPMaxHisV);
NRV=NodeN(actNodeRV,actPathRV,tERPMinRV,tERPMaxRV);

// ======== Path ========
PHRASA=Path(actPathHRA,actPathSA,actNodeHRA,actNodeSA,tCondMinHRASA,tCondMaxHRASA);
PSAHisA=Path(actPathSA,actPathHisA,actNodeSA,actNodeHisA,tCondMinSAHisA,tCondMaxSAHisA);
PHisAOS=Path(actPathHisA,actPathOS,actNodeHisA,actNodeOS,tCondMinHisAOS,tCondMaxHisAOS);

POSFP=Path(actPathOS,actPathFP,actNodeOS,actNodeFP,tCondMinOSFP,tCondMaxOSFP);
POSSP=Path(actPathOS,actPathSP,actNodeOS,actNodeSP,tCondMinOSSP,tCondMaxOSSP);
PFPAV=Path(actPathFP,actPathAV,actNodeFP,actNodeAV,tCondMinFPAV,tCondMaxFPAV);
PSPAV=Path(actPathSP,actPathAV,actNodeSP,actNodeAV,tCondMinSPAV,tCondMaxSPAV);

PAVHisH=Path(actPathAV,actPathHisH,actNodeAV,actNodeHisH,tCondMinAVHisH,tCondMaxAVHisH);
PHisHHisV=Path(actPathHisH,actPathHisV,actNodeHisH,actNodeHisV,tCondMinHisHHisV,tCondMaxHisHHisV);
PHisVRV=Path(actPathHisV,actPathRV,actNodeHisV,actNodeRV,tCondMinHisVRV,tCondMaxHisVRV);

// List one or more processes to be composed into a system.
system NHRA, PHRASA, NSA, PSAHisA, NHisA, PHisAOS, NOS, POSFP, NSP, POSSP, NFP, PFPAV, PSPAV, NAV, PAVHisH, NHisH, PHisHHisV, NHisV, PHisVRV, NRV,AVNRTInput,ConvertIn,ConvertOut,Timer;
</system>
	<queries>
		<query>
			<formula>E&lt;&gt; Timer.Stop</formula>
			<comment></comment>
		</query>
	</queries>
</nta>

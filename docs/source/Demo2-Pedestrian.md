# Demo2 - Pedestrian

**Note: we are woking on CAV-2024 tool paper. The documentation will be updated to a structure similar to Demo1-PipeNet before 2024.4.1.**

## 1. Problem Description

Comming Soon..

<img src=https://raw.githubusercontent.com/Jack0Chan/pyuppaal/main/src/test_demos/pedestrian.png width=600 />

## 2. Verifyta results


```python
import pyuppaal
from pyuppaal import UModel

print(pyuppaal.__version__)
pyuppaal.set_verifyta_path(r"C:\Users\Taco\Documents\GitHub\cav2024\bin\uppaal64-4.1.26\bin-Windows\verifyta.exe")


# Load the `xml` model and save as a new file in order not to overwrite current file
m = UModel("pedestrian.xml").save_as("demo_pedestrian.xml")
# enumerate ALL the options for verifyta.
verify_options = [' -t 0 -o 0', ' -t 0 -o 1', ' -t 0 -o 2', ' -t 1 -o 0', ' -t 1 -o 1',
                  ' -t 1 -o 2', ' -t 1 -o 3', ' -t 1 -o 4', ' -t 2 -o 0', ' -t 2 -o 1',
                  ' -t 2 -o 2', ' -t 2 -o 3', ' -t 2 -o 4'] 
res = []

F = ["pCheckLight", "pGreen", "pRed", "pYellow", "pCrss", "cCrss"]
for i, opt in enumerate(verify_options):
    res.append(m.easy_verify(verify_options=opt).filter_by_actions(F).untime_pattern)
res = set([ "-".join(r) for r in res])
for trace in res:
    print(trace.split('-'))
```

    1.2.0
    ['pCheckLight', 'pRed', 'pCrss', 'cCrss']
    ['cCrss', 'pCheckLight', 'pRed', 'pCrss']
    

## 3. find_all_patterns results

Pattern 3 and 4 are new patterns that can ONLY be identified PyUPPAAL.


```python
m = UModel("pedestrian.xml").save_as("demo_pedestrian.xml")
m.queries = "E<> (PPedestrian.Crossing and PCar.Crossing)"
sigma_focus = ["pCheckLight", "pGreen", "pRed", "pYellow", "pCrss", "cCrss"]
traces = m.find_all_patterns(focused_actions=sigma_focus)
for i, trace in enumerate(traces): print(f'pattern {i+1}:', trace.untime_pattern)
```

    pattern 1: ['pCheckLight', 'pRed', 'pCrss', 'cCrss']
    pattern 2: ['cCrss', 'pCheckLight', 'pRed', 'pCrss']
    pattern 3: ['pCheckLight', 'pGreen', 'pCrss', 'cCrss']
    pattern 4: ['pCheckLight', 'pYellow', 'pCrss', 'cCrss']
    

## 4. Communication Graph

Communication Graph (b) can be generated by the coding below, and rendered by [mermaid.live](https://mermaid.live/edit#pako:eNp9kMsKwjAQRX9FZt3-QBduLLhRKOpGyWZIpm2wTcI0RaT0350-oAhiVpnLOWFyB9DeEGRQMYZ6d8uV28kpDshpqg816efJVnVM031xYyxLq-e5W7mvTIwjE7lEX8gk-k5N41-TKa_95sPCh4kPG1-QoS6yRbdqWyDOn60ggZa4RWvkS8MkK4g1taQgk6tBfipQbhQO--ivb6chi9xTAn0wGCm3KE20kJXYdJIGdA_vt5mMjZ7PS2dzdeMHujFttQ).


```python
m.get_communication_graph()
```




    ```mermaid
    graph TD
    PCar--cCheckLight-->PTrafficLights
    PTrafficLights--cGreen,cRed,cYellow-->PCar
    PTrafficLights--pGreen,pRed,pYellow-->PPedestrian
    PPedestrian--pCheckLight-->PTrafficLights
    ```


